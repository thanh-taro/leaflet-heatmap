L.HeatMap=L.TileLayer.extend({options:{useCanvas:!0,altitudes:[0,255],opacity:1,colors:[{r:0,g:85,b:255},{r:0,g:88.66666666666671,b:255},{r:0,g:92.3333333333333,b:255},{r:0,g:96.00000000000003,b:255},{r:0,g:99.66666666666661,b:255},{r:0,g:103.33333333333333,b:255},{r:0,g:107.00000000000004,b:255},{r:0,g:110.66666666666664,b:255},{r:0,g:114.33333333333336,b:255},{r:0,g:117.99999999999994,b:255},{r:0,g:121.66666666666666,b:255},{r:0,g:125.33333333333337,b:255},{r:0,g:128.99999999999997,b:255},{r:0,g:132.66666666666669,b:255},{r:0,g:136.3333333333333,b:255},{r:0,g:139.99999999999997,b:255},{r:0,g:143.66666666666669,b:255},{r:0,g:147.3333333333333,b:255},{r:0,g:151,b:255},{r:0,g:154.6666666666666,b:255},{r:0,g:158.33333333333331,b:255},{r:0,g:162.00000000000003,b:255},{r:0,g:165.66666666666663,b:255},{r:0,g:169.33333333333331,b:255},{r:0,g:173.00000000000003,b:255},{r:0,g:176.66666666666663,b:255},{r:0,g:180.33333333333334,b:255},{r:0,g:183.99999999999994,b:255},{r:0,g:187.66666666666666,b:255},{r:0,g:191.3333333333334,b:255},{r:0,g:194.99999999999997,b:255},{r:0,g:198.66666666666669,b:255},{r:0,g:202.3333333333334,b:255},{r:0,g:206,b:255},{r:0,g:209.6666666666667,b:255},{r:0,g:213.33333333333331,b:255},{r:0,g:217.00000000000003,b:255},{r:0,g:220.66666666666674,b:255},{r:0,g:224.33333333333334,b:255},{r:0,g:228.00000000000003,b:255},{r:0,g:231.66666666666663,b:255},{r:0,g:235.33333333333334,b:255},{r:0,g:239.00000000000006,b:255},{r:0,g:242.66666666666666,b:255},{r:0,g:246.33333333333337,b:255},{r:0,g:249.99999999999997,b:255},{r:0,g:253.66666666666669,b:255},{r:0,g:255,b:252.66666666666663},{r:0,g:255,b:249.00000000000003},{r:0,g:255,b:245.33333333333331},{r:0,g:255,b:241.6666666666667},{r:0,g:255,b:238},{r:0,g:255,b:234.3333333333333},{r:0,g:255,b:230.66666666666669},{r:0,g:255,b:227},{r:0,g:255,b:223.3333333333334},{r:0,g:255,b:219.66666666666669},{r:0,g:255,b:215.99999999999997},{r:0,g:255,b:212.33333333333337},{r:0,g:255,b:208.66666666666666},{r:0,g:255,b:205.00000000000006},{r:0,g:255,b:201.33333333333334},{r:0,g:255,b:197.66666666666663},{r:0,g:255,b:193.99999999999991},{r:0,g:255,b:190.33333333333331},{r:0,g:255,b:186.66666666666674},{r:0,g:255,b:183},{r:0,g:255,b:179.3333333333333},{r:0,g:255,b:175.66666666666669},{r:0,g:255,b:171.99999999999997},{r:0,g:255,b:168.3333333333333},{r:0,g:255,b:164.66666666666669},{r:0,g:255,b:160.99999999999997},{r:0,g:255,b:157.33333333333337},{r:0,g:255,b:153.66666666666666},{r:0,g:255,b:150.00000000000006},{r:0,g:255,b:146.33333333333334},{r:0,g:255,b:142.66666666666663},{r:0,g:255,b:138.99999999999994},{r:0,g:255,b:135.33333333333334},{r:0,g:255,b:131.66666666666674},{r:0,g:255,b:128.00000000000003},{r:0,g:255,b:124.33333333333331},{r:0,g:255,b:120.6666666666666},{r:0,g:255,b:117.00000000000001},{r:0,g:255,b:113.33333333333341},{r:0,g:255,b:109.6666666666667},{r:0,g:255,b:105.99999999999999},{r:0,g:255,b:102.33333333333327},{r:0,g:255,b:98.66666666666669},{r:0,g:255,b:94.99999999999996},{r:0,g:255,b:91.33333333333337},{r:0,g:255,b:87.66666666666666},{r:0,g:255,b:83.99999999999994},{r:0,g:255,b:80.33333333333323},{r:0,g:255,b:76.66666666666663},{r:0,g:255,b:73.00000000000004},{r:0,g:255,b:69.33333333333333},{r:0,g:255,b:65.66666666666661},{r:0,g:255,b:62.00000000000002},{r:0,g:255,b:58.33333333333343},{r:0,g:255,b:54.666666666666714},{r:0,g:255,b:51},{r:0,g:255,b:47.333333333333286},{r:0,g:255,b:43.66666666666669},{r:0,g:255,b:40.0000000000001},{r:0,g:255,b:36.333333333333385},{r:0,g:255,b:32.66666666666667},{r:0,g:255,b:29.000000000000018},{r:0,g:255,b:25.333333333333364},{r:0,g:255,b:21.66666666666665},{r:0,g:255,b:17.999999999999996},{r:0,g:255,b:14.333333333333343},{r:0,g:255,b:10.66666666666669},{r:0,g:255,b:6.999999999999975},{r:0,g:255,b:3.3333333333333215},{r:.33333333333327175,g:255,b:0},{r:3.999999999999986,g:255,b:0},{r:7.6666666666667,g:255,b:0},{r:11.333333333333414,g:255,b:0},{r:15.000000000000007,g:255,b:0},{r:18.6666666666666,g:255,b:0},{r:22.333333333333314,g:255,b:0},{r:26.00000000000003,g:255,b:0},{r:29.666666666666742,g:255,b:0},{r:33.333333333333336,g:255,b:0},{r:37.00000000000005,g:255,b:0},{r:40.66666666666664,g:255,b:0},{r:44.33333333333336,g:255,b:0},{r:47.99999999999995,g:255,b:0},{r:51.666666666666664,g:255,b:0},{r:55.33333333333326,g:255,b:0},{r:58.99999999999997,g:255,b:0},{r:62.666666666666686,g:255,b:0},{r:66.3333333333334,g:255,b:0},{r:69.99999999999999,g:255,b:0},{r:73.66666666666659,g:255,b:0},{r:77.3333333333333,g:255,b:0},{r:81.00000000000001,g:255,b:0},{r:84.6666666666666,g:255,b:0},{r:88.33333333333344,g:255,b:0},{r:92.00000000000004,g:255,b:0},{r:95.66666666666663,g:255,b:0},{r:99.33333333333334,g:255,b:0},{r:103.00000000000006,g:255,b:0},{r:106.66666666666666,g:255,b:0},{r:110.33333333333324,g:255,b:0},{r:113.99999999999996,g:255,b:0},{r:117.66666666666667,g:255,b:0},{r:121.33333333333339,g:255,b:0},{r:124.99999999999999,g:255,b:0},{r:128.66666666666669,g:255,b:0},{r:132.3333333333333,g:255,b:0},{r:136,g:255,b:0},{r:139.6666666666666,g:255,b:0},{r:143.33333333333331,g:255,b:0},{r:147.00000000000003,g:255,b:0},{r:150.6666666666667,g:255,b:0},{r:154.33333333333331,g:255,b:0},{r:158.00000000000003,g:255,b:0},{r:161.66666666666663,g:255,b:0},{r:165.33333333333334,g:255,b:0},{r:168.99999999999994,g:255,b:0},{r:172.66666666666666,g:255,b:0},{r:176.33333333333337,g:255,b:0},{r:180.00000000000009,g:255,b:0},{r:183.66666666666666,g:255,b:0},{r:187.3333333333334,g:255,b:0},{r:190.99999999999997,g:255,b:0},{r:194.6666666666667,g:255,b:0},{r:198.3333333333333,g:255,b:0},{r:202.00000000000003,g:255,b:0},{r:205.66666666666674,g:255,b:0},{r:209.33333333333331,g:255,b:0},{r:213.00000000000003,g:255,b:0},{r:216.66666666666663,g:255,b:0},{r:220.33333333333334,g:255,b:0},{r:223.99999999999994,g:255,b:0},{r:227.66666666666666,g:255,b:0},{r:231.33333333333326,g:255,b:0},{r:235.00000000000006,g:255,b:0},{r:238.66666666666666,g:255,b:0},{r:242.33333333333337,g:255,b:0},{r:245.99999999999997,g:255,b:0},{r:249.66666666666669,g:255,b:0},{r:253.3333333333333,g:255,b:0},{r:255,g:253,b:0},{r:255,g:249.3333333333334,b:0},{r:255,g:245.6666666666666,b:0},{r:255,g:242,b:0},{r:255,g:238.3333333333333,b:0},{r:255,g:234.66666666666669,b:0},{r:255,g:230.99999999999997,b:0},{r:255,g:227.33333333333337,b:0},{r:255,g:223.66666666666666,b:0},{r:255,g:220.00000000000006,b:0},{r:255,g:216.33333333333337,b:0},{r:255,g:212.66666666666666,b:0},{r:255,g:209.00000000000006,b:0},{r:255,g:205.33333333333334,b:0},{r:255,g:201.66666666666674,b:0},{r:255,g:198.00000000000003,b:0},{r:255,g:194.33333333333343,b:0},{r:255,g:190.6666666666667,b:0},{r:255,g:187,b:0},{r:255,g:183.3333333333333,b:0},{r:255,g:179.66666666666669,b:0},{r:255,g:175.99999999999997,b:0},{r:255,g:172.33333333333337,b:0},{r:255,g:168.66666666666666,b:0},{r:255,g:165.00000000000006,b:0},{r:255,g:161.33333333333334,b:0},{r:255,g:157.66666666666666,b:0},{r:255,g:153.99999999999994,b:0},{r:255,g:150.33333333333334,b:0},{r:255,g:146.66666666666663,b:0},{r:255,g:143.00000000000003,b:0},{r:255,g:139.33333333333331,b:0},{r:255,g:135.6666666666667,b:0},{r:255,g:132,b:0},{r:255,g:128.33333333333331,b:0},{r:255,g:124.66666666666659,b:0},{r:255,g:121,b:0},{r:255,g:117.33333333333329,b:0},{r:255,g:113.66666666666669,b:0},{r:255,g:109.99999999999997,b:0},{r:255,g:106.33333333333339,b:0},{r:255,g:102.66666666666667,b:0},{r:255,g:98.99999999999994,b:0},{r:255,g:95.33333333333336,b:0},{r:255,g:91.66666666666664,b:0},{r:255,g:88.00000000000006,b:0},{r:255,g:84.33333333333333,b:0},{r:255,g:80.66666666666674,b:0},{r:255,g:77.00000000000003,b:0},{r:255,g:73.33333333333344,b:0},{r:255,g:69.6666666666666,b:0},{r:255,g:66,b:0},{r:255,g:62.33333333333329,b:0},{r:255,g:58.6666666666667,b:0},{r:255,g:54.999999999999986,b:0},{r:255,g:51.33333333333339,b:0},{r:255,g:47.66666666666668,b:0},{r:255,g:44.000000000000085,b:0},{r:255,g:40.33333333333325,b:0},{r:255,g:36.66666666666666,b:0},{r:255,g:32.99999999999994,b:0},{r:255,g:29.33333333333335,b:0},{r:255,g:25.666666666666636,b:0},{r:255,g:22.000000000000043,b:0},{r:255,g:18.33333333333333,b:0},{r:255,g:14.666666666666735,b:0},{r:255,g:10.9999999999999,b:0},{r:255,g:7.333333333333307,b:0},{r:255,g:3.666666666666714,b:0},{r:255,g:0,b:0}]},initialize:function(r,g){g=L.extend({},this.options,g),L.TileLayer.prototype.initialize.call(this,r,g),g.colors&&(this._colors=g.colors),g.altitudes&&(this._altitudes=g.altitudes),g.useCanvas&&(this._useCanvas=!0),this.on("tileload",this._onLoadCallback,this)},setAltitudes:function(r){this._altitudes=r;var g,b,t,a,e,i=this._tiles,s=this._data,h=this._colors,r=this._altitudes,n=this._useCanvas;for(id in i)if(g=i[id],(b=g.el).getAttribute("data-height-map-scaled")&&s[id])if(e=new Uint8ClampedArray(s[id]),t=parseInt(b.getAttribute("data-height-map-width")),a=parseInt(b.getAttribute("data-height-map-height")),n){var o=this._reScaleData(e,t,a,h,r).getContext("2d").getImageData(0,0,t,a),l=b.getContext("2d"),d=l.createImageData(t,a);d.data.set(o.data),l.putImageData(d,0,0)}else b.src=this._reScaleData(e,t,a,h,r).toDataURL()},setColors:function(r){this._colors=r,this.redraw()},useCanvas:function(r){this._useCanvas=r,this.redraw()},_onLoadCallback:function(r){var g=r.tile,b=r.coords,t=this._colors,a=this._altitudes,e=this._data=this._data||{},i=this._tileCoordsToKey(b),s=this._useCanvas;g.getAttribute("data-height-map-scaled")||this._scaleTile(g,t,a,function(r,g,b,t,a){var h=r.src;s?(g.className=r.className,g.style.transform=r.style.transform,r.parentNode.appendChild(g),L.DomUtil.remove(r),r=this._tiles[i].el=g):r.src=g.toDataURL(),r.setAttribute("data-height-map-id",i),r.setAttribute("data-height-map-src",h),r.setAttribute("data-height-map-width",t),r.setAttribute("data-height-map-height",a),r.setAttribute("data-height-map-scaled",!0),e[i]=b}.bind(this))},_scale:function(r,g,b,t,a){for(var e,i=a[1]-a[0],s=0,h=g*b*4,n=r;s<h;s+=4)0!==n[s+3]&&(n[s]<a[0]||n[s]>a[1]||0===i?n[s+3]=0:(e=t[Math.round(255*(n[s]-a[0])/i)],n[s]=e.r,n[s+1]=e.g,n[s+2]=e.b,n[s+3]=255))},_scaleTile:function(r,g,b,t){var a=(" "+r.src).slice(1),e=new Image,i=this;e.onload=function(){var a=this.width,e=this.height,s=L.DomUtil.create("canvas");s.width=a,s.height=e;var h=s.getContext("2d");h.clearRect(0,0,a,e),h.drawImage(this,0,0,a,e);var n=h.getImageData(0,0,a,e),o=n.data,l=new Uint8ClampedArray(o);return i._scale(o,a,e,g,b),h.putImageData(n,0,0),t(r,s,l,a,e)},e.src=a},_reScaleData:function(r,g,b,t,a){this._scale(r,g,b,t,a);var e=L.DomUtil.create("canvas");e.width=g,e.height=b;var i=e.getContext("2d"),s=i.createImageData(g,b);return s.data.set(r),i.putImageData(s,0,0),e}}),L.heatMap=function(r,g){return new L.HeatMap(r,g)};